<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <title>Ｃｕｒｓｅｄ interpreter</title>

    <link rel="stylesheet" href="css/styles.css">
    <script src="dist/bundle.js"></script>
    <script src="index.js"></script>
    <script>
        function resizeRainbow() { // The rainbow thing only works if there's extra space at the end of the div, so this resizes it.
            let codebox = document.getElementById("codebox");
            let rainBox = document.getElementById("rainbowBox");
            let codeSize = codebox.scrollHeight;

            rainBox.style.height = codeSize + "px";
        }

/*        function noBadHtml() {
            let codebox = document.getElementById("codebox");

            codebox.innerHTML = codebox.innerText.split("\n").map((i) => i.replace(/^/, "<div>").replace(/$/, "</div>")).join("");
        }
        This works, but it moves the cursor to the beginning of the box every time you do anything, so I might come back
        to it later if it becomes a pressing issue.
*/

        function popupJohnvertise() {
            let screenWidth = window.innerWidth;
            let screenHeight = window.innerHeight;

            console.log(screenHeight, screenWidth)

            // set size of the popup with a random multiplier
            let adSize = 1.25 - Math.random();
            let adWidth = Math.round(732 * adSize);
            let adHeight = Math.round(94 * adSize);

            // set a random position for the ad
            let offsetX = Math.floor(Math.random() * (screenWidth - adWidth));
            let offsetY = Math.floor(Math.random() * (screenHeight - adHeight));

            // if the ad is wider than the screen, get rid of the x offset
            adWidth >= screenWidth ? offsetX = "" : offsetX = `right:${offsetX}px;`;

            // spawn the ad
            document.body.innerHTML += `
    <div style="position:fixed; top:${offsetY}px; ${offsetX} height:${adHeight}px; width:${adWidth}px;" id="popup">
        <img src="./img/x.gif" style="height: 12px; width: 12px; cursor:grab;" onclick="this.parentElement.remove();"></img>
        <iframe src="https://john.mondecitronne.com/embed?ref=http://amiller42.github.io/Cursed-Language" style="margin-left:auto; display:block; max-width:${adWidth}px; width:100%; height:${adHeight}px; border:none;"></iframe>
    </div>`;

            // wait anywhere from 15-90 seconds to spawn another popup
            setTimeout(popupJohnvertise, Math.floor((Math.random() * 75000) + 15000));
        }

        // wait anywhere from 2-10 seconds before the first popup
        setTimeout(popupJohnvertise, Math.floor((Math.random() * 8000) + 2000));
    </script>
</head>
<body>
    <div>
        <h1>
            <marquee><span style="background: rgb(196, 247, 13);"><img src="./img/hacker.gif"></img>   WELCOME TO THE <a href="https://github.com/AMiller42/Cursed-Language">Ｃｕｒｓｅｄ</a> INTERPRETER!   <img src="./img/hacker.gif"></img></span></marquee>
        </h1>
        <img src="./img/rainbow.gif" width=100%></img>
    </div>
    <div id="topbar">
        <span id="buttons">
            <div class="btn-box"><button id="run" class="top-button" onclick="execute()"> Execute </button></div>
            <div class="btn-box"><button id="link" class="top-button" onclick="linkify()"> Linkify </button></div>
            <iframe src="https://john.mondecitronne.com/embed?ref=http://amiller42.github.io/Cursed-Language" style="margin-left:auto; display:block; max-width:732px; width:100%; height:94px; border:none;"></iframe>
        </span>
    </div>
    <p>Code:</p>
    <div class="rainbow" id="rainbowBox">
        <div style="background-color: black;">
            <div contenteditable="true" id="codebox" oninput="resizeRainbow();">Code goes here!</div>
        </div>
    </div>
</body>
</html>
